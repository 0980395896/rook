FROM debian:stretch
MAINTAINER Bassam Tabbara <bassam.tabbara@quantum.com>

RUN \
    dpkg --add-architecture ==ARCH== && \
    apt-get update && \
    DEBIAN_FRONTEND=noninteractive apt-get install -yq --no-install-recommends \
    \
    ca-certificates \
    ccache \
    cmake \
    curl \
    git \
    golang \
    mercurial \
    python \
    python-dev \
    python3 \
    python3-all-dev \
    cython \
    cython3 \
    runit \
    sudo \
    yasm \
    ==BUILD== \
    \
    libaio-dev:==ARCH== \
    libatomic-ops-dev:==ARCH== \
    libblkid-dev:==ARCH== \
    libboost-date-time-dev:==ARCH== \
    libboost-dev:==ARCH== \
    libboost-iostreams-dev:==ARCH== \
    libboost-program-options-dev:==ARCH== \
    libboost-random-dev:==ARCH== \
    libboost-regex-dev:==ARCH== \
    libboost-system-dev:==ARCH== \
    libboost-thread-dev:==ARCH== \
    libcrypto++-dev:==ARCH== \
    libcurl4-openssl-dev:==ARCH== \
    libexpat1-dev:==ARCH== \
    libfcgi-dev:==ARCH== \
    libgoogle-perftools-dev:==ARCH== \
    libjemalloc-dev:==ARCH== \
    libkeyutils-dev:==ARCH== \
    libldap2-dev:==ARCH== \
    libleveldb-dev:==ARCH== \
    libsnappy-dev:==ARCH== \
    libssl-dev:==ARCH== \
    libudev-dev:==ARCH== \
    \
    && \
    apt-get clean && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*

WORKDIR /build
COPY entrypoint.sh /build

ENTRYPOINT [ "/build/entrypoint.sh" ]
