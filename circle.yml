machine:
  environment:
    NPROCS: $(( ($(grep -c ^processor /proc/cpuinfo) + 1) / 2 ))
  services:
    - docker

checkout:
  pre:
    - echo -e "machine github.com\n\tlogin quantumbuild\n\tpassword $GITHUB_TOKEN" > ~/.netrc
    - rm ~/.gitconfig
  post:
    - git submodule sync --recursive
    - git submodule update --recursive --init

dependencies:
  cache_directories:
    - ~/.ccache
  
  override:
    - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
    - docker pull quantum/castle-build
    - ./build/run-build.sh make -j$NPROCS check

test:
  override:
    - echo no tests
